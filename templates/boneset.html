<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bone Set Viewer</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>

    <!-- Badge with Sidebar Toggle Button -->
    <div id="badge">
        <button id="toggle-sidebar">â˜°</button>
        <span id="text-button-Home" role="button">Home</span>
        <span id="text-button-Tutor" role="button">Tutor</span>
        <span id="text-button-Study" role="button">Study</span>
        <span id="text-button-Help" role="button">Help</span>
        <div id="innerbadge">
            <span id="text-button-Login" role="button">Login</span>
            <span id="text-button-SignUp" role="button">Sign Up</span>
        </div>
    </div>

    <!-- Sidebar Container -->
    <div id="sidebar-container"></div>
    <script src="sidebar.js"></script>

    <div id="editor-view">
        <div class="container">
            <h1>Bone Set Viewer</h1>

            <!-- Search Bar -->
            <input type="text" id="search-bar" placeholder="Search bone sets" />
            <ul id="search-results"></ul>

            <!-- Dropdown Section (Side-by-Side Flex Layout) -->
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <label for="bonesets">Choose a Boneset, Bone, or Sub-bone:</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="boneset-select">
                        <option value="">--Please select a Boneset--</option>
                    </select>
                    <select id="bone-select" disabled>
                        <option value="">--Please select a Bone--</option>
                    </select>
                    <select id="subbone-select" disabled>
                        <option value="">--Please choose a Sub-Bone--</option>
                    </select>
                </div>
            </div>

            <!-- Container for the Boneset Names and IDs -->
            <div id="bone-sets-container">
                <h2>Bonesets</h2>
                <ul id="bone-set-list"></ul>
            </div>

            <div class="navigation-buttons">
                <button id="prev-button" disabled>Previous</button>
                <button id="next-button" disabled>Next</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3001/combined-data';
        let combinedData = { bonesets: [], bones: [], subbones: [] };
        let currentSetIndex = 0;

        async function fetchCombinedData() {
            try {
                const response = await fetch(API_URL);
                return await response.json();
            } catch (error) {
                console.error("Error fetching data:", error);
                alert("Failed to load data.");
            }
        }

        function populateDropdowns() {
            const bonesetSelect = document.getElementById('boneset-select');
            bonesetSelect.innerHTML = '<option value="">--Please select a Boneset--</option>';
            combinedData.bonesets.forEach(set => {
                const option = document.createElement('option');
                option.value = set.id;
                option.textContent = set.name;
                bonesetSelect.appendChild(option);
            });
        }

        function renderBoneSet(boneSet) {
            const list = document.getElementById('bone-set-list');
            list.innerHTML = '';

            const li = document.createElement('li');
            li.textContent = boneSet.name;
            list.appendChild(li);

            const subList = document.createElement('ul');
            boneSet.bones.forEach(boneId => {
                const subLi = document.createElement('li');
                subLi.textContent = `ID: ${boneId}`;
                subList.appendChild(subLi);
            });
            list.appendChild(subList);
        }

        document.getElementById('boneset-select').addEventListener('change', (e) => {
            const selectedBonesetId = e.target.value;
            const boneSelect = document.getElementById('bone-select');
            const subboneSelect = document.getElementById('subbone-select');

            const relatedBones = combinedData.bones.filter(b => b.boneset === selectedBonesetId);

            boneSelect.innerHTML = '<option value="">--Please select a Bone--</option>';
            subboneSelect.innerHTML = '<option value="">--Please choose a Sub-Bone--</option>';
            subboneSelect.disabled = true;

            relatedBones.forEach(bone => {
                const option = document.createElement('option');
                option.value = bone.id;
                option.textContent = bone.name;
                boneSelect.appendChild(option);
            });

            boneSelect.disabled = false;
        });

        document.getElementById('bone-select').addEventListener('change', (e) => {
            const selectedBoneId = e.target.value;
            const subboneSelect = document.getElementById('subbone-select');

            const relatedSubbones = combinedData.subbones.filter(sb => sb.bone === selectedBoneId);

            subboneSelect.innerHTML = '<option value="">--Please choose a Sub-Bone--</option>';

            relatedSubbones.forEach(sb => {
                const option = document.createElement('option');
                option.value = sb.id;
                option.textContent = sb.name;
                subboneSelect.appendChild(option);
            });

            subboneSelect.disabled = relatedSubbones.length === 0;
        });

        // Initialization
        document.addEventListener('DOMContentLoaded', async () => {
            combinedData = await fetchCombinedData();
            populateDropdowns();

            const boneset = combinedData.bonesets[0];
            if (boneset) {
                renderBoneSet({
                    name: boneset.name,
                    bones: combinedData.bones.filter(b => b.boneset === boneset.id).map(b => b.id)
                });
            }

            document.getElementById('prev-button').disabled = true;
            document.getElementById('next-button').disabled = combinedData.bonesets.length <= 1;
        });
    </script>
</body>

</html>