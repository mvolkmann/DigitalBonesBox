<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bone Set Viewer</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Badge with Sidebar Toggle Button -->
    <div id="badge">
        <button id="toggle-sidebar">â˜°</button>
        <span id="text-button-Home" role="button">Home</span>
        <span id="text-button-Tutor" role="button">Tutor</span>
        <span id="text-button-Study" role="button">Study</span>
        <span id="text-button-Help" role="button">Help</span>

        <div id="innerbadge">
            <span id="text-button-Login" role="button">Login</span>
            <span id="text-button-SignUp" role="button">Sign Up</span>
        </div>
    </div>

    <!-- Sidebar Container -->
    <div id="sidebar-container"></div>

    <script src="sidebar.js"></script>

    <div id="editor-view">
        <div class="container">
            <h1>Bone Set Viewer</h1>

            <!-- Dropdown for Boneset Selection -->
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <label for="boneset-select">Choose a Boneset:</label>
                <select id="boneset-select">
                    <option value="">--Please select a Boneset--</option>
                </select>

                <label for="bone-select">Choose a Bone:</label>
                <select id="bone-select" disabled>
                    <option value="">--Please select a Bone--</option>
                </select>

                <label for="subbone-select">Choose a Sub-Bone:</label>
                <select id="subbone-select" disabled>
                    <option value="">--Please choose a Sub-Bone--</option>
                </select>
            </div>

            <!-- Display Selected Data -->
            <div id="selected-data" style="margin-top: 20px;">
                <h2>Selected Information</h2>
                <p id="selected-info">No selection made yet.</p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000/combined-data';

        async function fetchCombinedData() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("Failed to fetch combined data");
                return await response.json();
            } catch (error) {
                console.error("Error fetching data:", error);
                alert("Error fetching data from the server.");
            }
        }

        // Populate Boneset Dropdown
        function populateBonesetDropdown(bonesets) {
            const bonesetSelect = document.getElementById("boneset-select");
            bonesets.forEach(boneset => {
                const option = document.createElement("option");
                option.value = boneset.id;
                option.textContent = boneset.name;
                bonesetSelect.appendChild(option);
            });
        }

        // Populate Bone Dropdown
        function populateBoneDropdown(bones, selectedBoneset) {
            const boneSelect = document.getElementById("bone-select");
            boneSelect.innerHTML = '<option value="">--Please select a Bone--</option>';
            bones
                .filter(bone => bone.boneset === selectedBoneset)
                .forEach(bone => {
                    const option = document.createElement("option");
                    option.value = bone.id;
                    option.textContent = bone.name;
                    boneSelect.appendChild(option);
                });
            boneSelect.disabled = false;
        }

        // Populate Sub-Bone Dropdown
        function populateSubboneDropdown(subbones, selectedBone) {
            const subboneSelect = document.getElementById("subbone-select");
            subboneSelect.innerHTML = '<option value="">--Please choose a Sub-Bone--</option>';
            subbones
                .filter(subbone => subbone.bone === selectedBone)
                .forEach(subbone => {
                    const option = document.createElement("option");
                    option.value = subbone.id;
                    option.textContent = subbone.name;
                    subboneSelect.appendChild(option);
                });
            subboneSelect.disabled = false;
        }

        // Display Selected Information
        function displaySelectedInfo(text) {
            document.getElementById("selected-info").textContent = text;
        }

        // Initialize Dropdowns
        async function initDropdowns() {
            const data = await fetchCombinedData();
            if (data) {
                populateBonesetDropdown(data.bonesets);

                // Boneset Selection
                document.getElementById("boneset-select").addEventListener("change", (e) => {
                    const selectedBoneset = e.target.value;
                    populateBoneDropdown(data.bones, selectedBoneset);
                    displaySelectedInfo(`Selected Boneset: ${e.target.options[e.target.selectedIndex].text}`);
                    document.getElementById("subbone-select").disabled = true;
                });

                // Bone Selection
                document.getElementById("bone-select").addEventListener("change", (e) => {
                    const selectedBone = e.target.value;
                    populateSubboneDropdown(data.subbones, selectedBone);
                    displaySelectedInfo(`Selected Bone: ${e.target.options[e.target.selectedIndex].text}`);
                });

                // Sub-Bone Selection
                document.getElementById("subbone-select").addEventListener("change", (e) => {
                    displaySelectedInfo(`Selected Sub-Bone: ${e.target.options[e.target.selectedIndex].text}`);
                });
            }
        }

        // Initialize on Load
        window.onload = initDropdowns;
    </script>
</body>

</html>